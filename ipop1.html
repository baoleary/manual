<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>IPOP (IP-over-P2P) Virtual Network Tutorial | FutureGrid Portal</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/sites/default/files/favicon.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/sites/default/files/css/css_bd5c48583c9b2b02db8c0eac414d042a.css" />
<link type="text/css" rel="stylesheet" media="print" href="/sites/default/files/css/css_a3e173272d6d31544be2a410a3201539.css" />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="all" href="/sites/all/themes/fgtheme/css/ie.css?s" />
<![endif]-->
<!--[if lte IE 6]>
<link type="text/css" rel="stylesheet" media="all" href="/sites/all/themes/fgtheme/css/ie6.css?s" />
<![endif]-->
  <script type="text/javascript" src="/sites/default/files/js/js_30bee27306918f99753a2ec1f6fa249c.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/", "fivestar": { "titleUser": "Your rating: ", "titleAverage": "Average: ", "feedbackSavingVote": "Saving your vote...", "feedbackVoteSaved": "Your vote has been saved.", "feedbackDeletingVote": "Deleting your vote...", "feedbackVoteDeleted": "Your vote has been deleted." }, "googleanalytics": { "trackOutbound": 1, "trackMailto": 1, "trackDownload": 1, "trackDownloadExtensions": "7z|aac|arc|arj|asf|asx|avi|bin|csv|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls|xml|z|zip" } });
//--><!]]>
</script>
</head>
<body class="page not-front not-logged-in node-type-page no-sidebars page-tutorials-ipop1 section-tutorials page-panels">

  
  <div id="page-wrapper"><div id="page">

    <div id="header"><div class="section clearfix">

              <a href="/" title="Home" rel="home" id="logo"><img src="/sites/all/themes/fgtheme/logo.png" alt="Home" /></a>
      
            
            	<div id="top-menu">
											<div id="session"><div class="region region-session">
  <div id="block-menu-menu-user" class="block block-menu first last region-odd odd region-count-1 count-7">
  
  <div class="content">
    <ul class="menu"><li class="collapsed my-account first"><a href="/user/login">Log in</a></li>
<li class="leaf register last"><a href="/user/register" title=""><span class="tab">Register</span></a></li>
</ul>  </div>

  </div><!-- /.block -->
</div><!-- /.region -->
</div>
										
											<div id="search-box"><form action="/tutorials/ipop1"  accept-charset="UTF-8" method="post" id="search-theme-form">
<div><div id="search" class="container-inline">
  <div class="form-item" id="edit-search-theme-form-1-wrapper">
 <label for="edit-search-theme-form-1">Search this site: </label>
 <input type="text" maxlength="128" name="search_theme_form" id="edit-search-theme-form-1" size="15" value="" title="Enter the terms you wish to search for." class="form-text" />
</div>
<input type="submit" name="op" id="edit-submit" value="Search"  class="form-submit" />
<input type="hidden" name="form_build_id" id="form-qO1FtkOO2vKTA4BSuxoO8I9l2gRX7tgOpUYQ51JGvOA" value="form-qO1FtkOO2vKTA4BSuxoO8I9l2gRX7tgOpUYQ51JGvOA"  />
<input type="hidden" name="form_id" id="edit-search-theme-form" value="search_theme_form"  />
</div>

</div></form>
</div>
									</div>
			
      <div class="region region-header">
  <div id="block-menu-menu-social-network" class="block block-menu first last region-odd even region-count-1 count-2">
  
  <div class="content">
    <ul class="menu"><li class="leaf blogger first"><a href="http://futuregridtestbed.blogspot.com/" title="">Blogger</a></li>
<li class="leaf facebook"><a href="https://www.facebook.com/pages/FutureGrid/334463263254672" title="">Facebook</a></li>
<li class="leaf google"><a href="https://plus.google.com/100917243498949712032/posts" title="">Google</a></li>
<li class="leaf twitter"><a href="https://twitter.com/#!/futuregrid" title="">Twitter</a></li>
<li class="leaf rss last"><a href="/rss" title="FutureGrid RSS Feeds">RSS</a></li>
</ul>  </div>

  </div><!-- /.block -->
</div><!-- /.region -->

    </div></div><!-- /.section, /#header -->

    <div id="main-wrapper"><div id="main" class="clearfix with-navigation">

      <div id="content" class="column"><div class="section">

        
        
                          <h1 class="title">IPOP (IP-over-P2P) Virtual Network Tutorial</h1>
                                  <div class="tabs"><ul class="tabs primary clearfix"><li class="view active"><a href="/tutorials/ipop1" class="active"><span class="tab">View</span></a></li>
<li class="what-links-here"><a href="/node/2522/backlinks"><span class="tab">What links here</span></a></li>
</ul></div>
                
        
        <div id="content-area">
          <div id="node-2522" class="node-type-page clearfix">
  
  
  
  
  <div class="content">
    <h3>
	Summary:</h3>
<p><a href="http://www.ipop-project.org">IPOP (IP-over-P2P)</a> is a software-defined virtual network that can be used as a basis for creating virtual private clusters across multiple cloud providers and administrative domains. IPOP is architected as a peer-to-peer (P2P) overlay for tunneling and routing of encapsulated IP packets that are captured/injected into virtual network interfaces (v-NICs). The IPOP software consists of P2P routers that run on endpoints that are connected to the virtual network, such as virtual machines (VMs) distributed across multiple cloud providers.<br />
	<br />
	This tutorial provides step-by-step instructions for deploying a demonstration IP-over-P2P (IPOP) virtual network among VMs that can be deployed on different commercial and private clouds, as well as on your own resources. These include FutureGrid Nimbus/OpenStack clouds, Amazon EC2, as well as virtual machines that you can run on your own computer using VMware or VirtualBox.<br />
	&nbsp;</p>
<h3>
	Prerequisites:</h3>
<ul>
	<li>
		Basic understanding of virtual networking and IPOP
		<ul>
			<li>
				Refer to documentation on the <a href="http://www.ipop-project.org">IPOP project&#39;s web site</a>; a good starting point is this open <a href="https://fgmoocs.appspot.com/ipop">online course &quot;MOOC&quot; module</a></li>
		</ul>
	</li>
	<li>
		Basic knowledge of Unix/Linux command line tools</li>
	<li>
		If you plan to use a virtual machine on your desktop, you need <a href="http://www.vmware.com">VMware</a> or <a href="http://www.virtualbox.org">VirtualBox</a> installed on your computer</li>
	<li>
		If you plan to use Amazon EC2, you need an <a href="http://aws.amazon.com">Amazon Web Services (AWS)</a> account&nbsp;</li>
	<li>
		Depending on whether you plan to use Nimbus, OpenStack, one of the following tutorials is required:
		<ul>
			<li>
				<a href="https://portal.futuregrid.org/tutorials/nimbus">Using Nimbus on&nbsp;FutureGrid</a></li>
			<li>
				<a href="https://portal.futuregrid.org/tutorials/openstack">Using OpenStack on&nbsp;FutureGrid</a></li>
		</ul>
	</li>
</ul>
<h4>
	&nbsp;</h4>
<h3>
	Step 1: Deploying VMs to be connected by IPOP</h3>
The first step in this tutorial is to deploy at least two virtual machines which will be connected by an IPOP virtual network.&nbsp;IPOP runs inside VMs - the main requirement for IPOP to work is that the VMs are connected to the Internet. The VM can either have a public address, or have a private address that connects to the public Internet through a Network Address Translator (NAT). You can, for instance deploy one VM on your computer, and one VM on FutureGrid, and observe how they get connected by the virtual network.<br />
<br />
IPOP is currently packaged for Debian/Ubuntu Linux systems, so you need to run a virtual machine based off these distributions. The following steps describe how to run virtual machines on FutureGrid, Amazon EC2, or your own desktop - select which approach you want to use and follow the instructions below to deploy at least two virtual machines.<br />
<br />
<ul>
	<li>
		<em><strong>Option 1: Deploying a VM on FutureGrid Using Nimbus</strong></em></li>
</ul>
<br />
A Nimbus image with Ubuntu 12.04 is available on TACC&#39;s&nbsp;cluster (Alamo) with&nbsp;KVM&nbsp;virtualization technology. The image name is &quot;ubuntu12.04.x64.kvm&quot; and it is available to all&nbsp;FutureGrid&nbsp;users.&nbsp;Use the&nbsp;<a href="https://portal.futuregrid.org/tutorials/nimbus">Nimbus&nbsp;cloud-client.sh&nbsp;client</a>&nbsp;as described in the Nimbus tutorial to deploy a virtual machine on Alamo:<br />
<br />
cloud-client.sh --conf conf/alamo.conf --run --name ubuntu12.04.x64.kvm --hours 24<br />
<br />
<ul>
	<li>
		<em><strong>Option 2: Deploying a VM on FutureGrid Using OpenStack</strong></em></li>
</ul>
<p>&nbsp;</p>
<p>An OpenStack image with Ubuntu 12.04 is available on IU&#39;s cluster (india). The image AMI ID is &quot;ami-0000000d&quot; and it is available to all&nbsp;FutureGrid&nbsp;users.&nbsp;Use euca2ools&nbsp;as described in the OpenStack tutorial to deploy a virtual machine on india:<br />
	<br />
	euca-run-instances -k keyname -n 1 ami-0000000d</p>
<ul>
	<li>
		<em><strong>Option 3: Deploying a VM on Amazon EC2</strong></em></li>
</ul>
<p>Amazon EC2 has a Ubuntu 12.04 image available (Ubuntu Server 12.04.2 LTS) with AMI ID&nbsp;ami-d0f89fb9 which has been tested and is known to work with this tutorial; other recent Debian/Ubuntu AMIs should also work. Follow instructions from Amazon EC2 to deploy instances of this virtual machine. NOTE: This has been tested on an EC2 instance configured with a Security Group that does not block UDP traffic - i.e. with a rule for UDP:&nbsp;</p>
<pre>
1 - 65535	0.0.0.0/0</pre>
<ul>
	<li>
		<em><strong>Option 4: Deploying a VM on your computer (VMware, VirtualBox)</strong></em></li>
</ul>
<p>While there are several possible Debian/Ubuntu images that you can use for this tutorial, an image that has been tested and is known to work is a <a href="http://www.trendsigma.net/vmware/debian6t.html">Debian Squeeze appliance</a> that runs on VMware.</p>
<br />
<h3>
	Step 2: Establishing IPOP connectivity between two VMs</h3>
One you finish step 1 and have two VMs up and running, you will install and deploy IPOP on the VMs to establish connectivity between them over a virtual network.<br />
<br />
To make the process simpler for the first time you use IPOP, this tutorial uses configuration files with several pre-set values to minimize configuration steps from your part. Once you finish the tutorial and understand how IPOP can be dpeloyed, you can use these configuration files as templates to deploy other IPOP virtual networks.<br />
<br />
We assume that you have deployed two VMs - we will be refer to them as &quot;Alice&quot; and &quot;Bob&quot; in the rest of the tutorial. The &quot;Alice&quot; VM will be configured with an IPOP virtual IP address 192.168.10.10, while the &quot;Bob&quot; VM&nbsp;will be configured with an IPOP virtual IP address 192.168.10.20.<br />
<br />
<em><strong>2.1) Bring up IPOP in the &quot;Alice&quot; VM</strong></em>

	&nbsp;
<br />
First, you need to remote login (using ssh) into the first VM instance you deployed - let&#39;s call it &quot;Alice&quot;. To ssh into the VM using ssh, follow the instructions based on the respective cloud/VM you are using (Nimbus, OpenStack, EC2). Once you are logged to the VM, install the tutorial files as follows (you can copy and paste the commands below to avoid mistakes):<br />
<br />
<em>(Note: you must perform these steps as the user &quot;root&quot;. If you have not ssh&#39;ed into the machine as root,&nbsp;</em><em>e.g. as the &quot;ubuntu&quot; user&quot;,&nbsp;</em><em>you need to first run &quot;sudo bash&quot; to become root; in the Debian squeeze appliance, type &quot;su&quot; and enter &quot;password&quot; - without quotes - when prompted)</em><br />
<br />

	wget <a href="http://www.acis.ufl.edu/~renato/ipopdemo/ipop_demo_prepare_debian.zip" title="http://www.acis.ufl.edu/~renato/ipopdemo/ipop_demo_prepare_debian.zip">http://www.acis.ufl.edu/~renato/ipopdemo/ipop_demo_prepare_debian.zip</a><br />
	apt-get install unzip<br />
	unzip ipop_demo_prepare_debian.zip

	<br />
	<br />
	Now, on to configuring your virtual network node for this demo. To do this, you need two pieces of information: the IPOP &quot;namespace&quot;, which is a string that uniquely identifies your virtual network in the P2P system, and a virtual IP address. The script below helps configure these parameters: you need to substitute CHANGE_THIS by another string to uniquely identify your IPOP network during this tutorial. For instance, if you run this tutorial on May 21 2013, you could substitute CHANGE_THIS by a string such as ipop_tutorial_05_21_2013_your_name. The second parameter is the last byte of the virtual IP address - we will use &quot;10&quot; for Alice, so it gets 192.168.10.10:<br />
	<br />
	./ipop_demo_prepare.sh CHANGE_THIS 10<br />
	&nbsp;<br />
	At the end of this process, you should be able to see a &quot;tapipop&quot; virtual network interface configured with the 192.168.10.10 virtual IP address. (<strong>Note:</strong>&nbsp;the tutorial files assume the private network 192.168.10.0/255.255.255.0 does not conflict with a network your VM is attached to, which is typically the case. If needed, you can change the base address/netmask by editing the respective in ipop_demo_prepare.sh)<br />
	<br />
	Type the following command to confirm:<br />
	<br />
	ifconfig tapipop<br />
	<br />
	And you should see an output that looks like this:<br />
	<br />
	
		tapipop &nbsp; Link encap:Ethernet &nbsp;HWaddr 96:44:a8:53:67:2a &nbsp;<br />
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.10.10 &nbsp;Bcast:192.168.255.255 &nbsp;Mask:255.255.255.0<br />
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1200 &nbsp;Metric:1<br />
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RX packets:525 errors:0 dropped:0 overruns:0 frame:0<br />
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TX packets:277 errors:0 dropped:0 overruns:0 carrier:0<br />
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;collisions:0 txqueuelen:500<br />
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:56314 (56.3 KB) &nbsp;TX bytes:32314 (32.3 KB)<br />
		&nbsp;
	<br />
	<em><strong>2.2) Bring up IPOP in the &quot;Bob&quot; VM</strong></em><br />
	<br />
	Now using another terminal, ssh into the &quot;Bob&quot; VM and repeat the same process you did for Alice (again, as root):<br />
	&nbsp;

	<br />
	wget <a href="http://www.acis.ufl.edu/~renato/ipopdemo/ipop_demo_prepare_debian.zip" title="http://www.acis.ufl.edu/~renato/ipopdemo/ipop_demo_prepare_debian.zip">http://www.acis.ufl.edu/~renato/ipopdemo/ipop_demo_prepare_debian.zip</a><br />
	apt-get install unzip<br />
	unzip ipop_demo_prepare_debian.zip

	<br />
	<br />
	To configure IPOP namespace and IP address in the Bob VM, substitute CHANGE_THIS <strong>by the exact same string</strong>&nbsp;you used when configuring Alice, and set the IP address last byte to be &quot;20&quot;, as follows. Be careful when typing, because if the namespace strings do not exactly match, your tutorial will not work correctly:<br />
	<br />
	./ipop_demo_prepare.sh CHANGE_THIS 20<br />
	<br />
	At the end of this process, as in the Alice VM, you should be able to also see a &quot;tapipop&quot; virtual network interface; in the Bob VM, it is configured with the 192.168.10.20 virtual IP address.&nbsp;<br />
	<br />
	
		<em><strong>2.3) Get Alice and Bob connected</strong></em>
	<p>We will use now the &quot;ping&quot; tool to send ICPM echo packets between Alice and Bob over the IPOP virtual network. Ping is a helpful tool for basic diagnostics of network connectivity, so we use it in this demonstration; once you confirm that ICMP packets are flowing with ping, you should be able to have any other TCP/IP traffic running over the virtual network.<br />
		<br />
		Login into Alice, and ping Bob, as follows:<br />
		<br />
		ping 192.168.10.20<br />
		<br />
		(Or, vice versa, you can log in Bob and ping Alice:&nbsp;ping 192.168.10.10)<br />
		<br />
		In the typical case, assuming you are not behind a symmetric NAT, you should see the following pattern: First, a few ICMP ping packets being dropped in the beginning, followed by a few packets that may have long latencies (hundreds of miliseconds, see packet with icmp_seq 6 below), then packets with lower latency. The following snapshot shows an example of the kind of output you should expect if you deploy your VMs in the same data center (the latency may be shorter or longer in your case depending on network conditions and NAT/firewall behavior):</p>
	
		PING 192.168.10.20 (192.168.10.20) 56(84) bytes of data.<br />
		From 192.168.10.10 icmp_seq=1 Destination Host Unreachable<br />
		From 192.168.10.10 icmp_seq=2 Destination Host Unreachable<br />
		From 192.168.10.10 icmp_seq=3 Destination Host Unreachable<br />
		From 192.168.10.10 icmp_seq=4 Destination Host Unreachable<br />
		From 192.168.10.10 icmp_seq=5 Destination Host Unreachable<br />
		64 bytes from 192.168.10.20: icmp_req=6 ttl=64 time=1008 ms<br />
		64 bytes from 192.168.10.20: icmp_req=7 ttl=64 time=8.46 ms<br />
		64 bytes from 192.168.10.20: icmp_req=8 ttl=64 time=1.87 ms<br />
		64 bytes from 192.168.10.20: icmp_req=9 ttl=64 time=1.87 ms<br />
		64 bytes from 192.168.10.20: icmp_req=10 ttl=64 time=1.64 ms
	
		<br />
		<br />
		What is going on in this example? Your two virtual macihnes are connected to a larger P2P overlay, with nodes distributed all over the world - we use the PlanetLab system to host a &quot;bootstrapping&quot; IPOP overlay.<br />
		<br />
		Before Alice and Bob communicate with each other, they need to locate each other&#39;s identifier in the P2P overlay. During the first few seconds, Alice and Bob are part of the P2P overlay, but they have not communicated before, so the first thing that needs to take place is a lookup to map Namespace:virtualIP of each node to their respective IPOP P2P identifier in the overlay. This lookup is performed as a Distributed Hash Table (DHT) query in the P2P overlay, and until the query is complete, packets will be dropped&nbsp;(ICMP packets 1-5 in the example above).<br />
		<br />
		Once the IP-P2P lookup is done, packets can flow between Alice and Bob; however, initially they can take a long overlay path, going through several intermediate nodes, because it is very unlikely that Alice and Bob are P2P &quot;neighbors&quot; to begin with. In the example above, Alice and Bob are in the same data center, but ICMP packet #6 takes about a second of round trip time because it&#39;s routed over multiple P2P nodes. This interaction triggers a process whereby Alice and Bob simultaneuously attempt to create a direct connection between each other. Once it is established, the round-trip time drops significantly (packets 7-10).<br />
		<br />
		<h3>
			Step 3: Securing communications between Alice and Bob</h3>
		One you finish steps 1 and 2, you have two VMs up and running and connected by the IPOP virtual network. Up to this point, however, communication between Alice and Bob is not private. In this step, we will configure IPsec to secure communications between Alice and Bob, providing privacy, integrity, and authentication at the IP layer.<br />
		<br />
		There are many options to configure IPsec - what is important to notice is that IPsec is layered atop IPOP, and because of this layering and separation of concerns, neither the IPsec software (in the Linux kernel) nor IPOP need to be modified.&nbsp;<br />
		<br />
		<em><strong>3.1) Bring up IPsec in the &quot;Alice&quot; VM</strong></em><br />
		<br />
		This step also uses configuration files with several pre-set values to minimize configuration steps from your part. We use the &quot;racoon&quot; software to configure IPsec, and the configuration is based on the use of X.509 certificates. In this example, both Alice and Bob are configured with certificates signed by the same certificate authority (CA), and racoon is configured at each node to allow any VM with a valid certificate signed by this trusted CA to communicate. Run the following commands on Alice to setup IPsec/racoon (again, as root):<br />
		<br />
		
			wget <a href="http://www.acis.ufl.edu/~renato/ipopdemo/ipop_ipsec_demo_prepare_debian.zip" title="http://www.acis.ufl.edu/~renato/ipopdemo/ipop_ipsec_demo_prepare_debian.zip">http://www.acis.ufl.edu/~renato/ipopdemo/ipop_ipsec_demo_prepare_debian.zip</a><br />
			unzip ipop_ipsec_demo_prepare_debian.zip<br />
			./ipop_ipsec_demo_prepare.sh
		
			<br />
			<br />
			The main configuration that takes place as part of this demo script are as follows:
			<ul>
				<li>
					The CA&#39;s certificate (cacert.pem), as well as the certificate (host-cert.pem) and private key (host-key.pem) of each node, are placed in the /etc/racoon/certs directory</li>
				<li>
					The racoon configuration file is placed in /etc/racoon/racoon.conf - it describes that x.509 certificates will be used to set up IPsec security associations, and configures other security policies</li>
				<li>
					The IPsec configuration file is placed in /etc/ipsec-tools.conf - it establishes that all communications within the IPOP virtual network (192.168.10.0/24 by default in this demo) are subject to IPsec security.</li>
			</ul>
			<br />
			<em><strong>3.2) Bring up IPsec in the &quot;Bob&quot; VM</strong></em><br />
			<br />
			Repeat the same steps, again, as root:<br />
			<br />
			
				wget <a href="http://www.acis.ufl.edu/~renato/ipopdemo/ipop_ipsec_demo_prepare_debian.zip" title="http://www.acis.ufl.edu/~renato/ipopdemo/ipop_ipsec_demo_prepare_debian.zip">http://www.acis.ufl.edu/~renato/ipopdemo/ipop_ipsec_demo_prepare_debian.zip</a><br />
				unzip ipop_ipsec_demo_prepare_debian.zip<br />
				./ipop_ipsec_demo_prepare.sh
			
				<br />
				<br />
				<em><strong>3.3) Connecting Alice and Bob</strong></em><br />
				<br />
				As done in the previous step, log in to Alice and ping Bob. On Alice:<br />
				<br />
				ping 192.168.10.20<br />
				<br />
				You will notice a similar behavior to the previous step - ping packets may drop in the beginning, then communication flows. Here, the reason packets may drop is due to the negotiation of security keys done by IPsec.<br />
				<br />
				Alice and Bob continue to ping each other in the same manner now - what is different is that all communication now is authenticated and encrypted. For instance, if Alice stops running IPsec, or does not produce a valid signed certificate when they negotiate keys, it will not be able to connect to Bob (and vice-versa).<br />
				<br />
				<em><strong>3.4) Inspecting secure communications</strong></em><br />
				<br />
				To confirm this, let&#39;s change the ping command slightly to add a &quot;payload&quot; to the message, and inspect IP packets using the &quot;tcpdump&quot; tool.<br />
				<br />
				On Bob, run tcpdump to capture and show a count of ten packets sent/received to/from Alice&#39;s IP in the tapipop interface:<br />
				<br />
				tcpdump -X -i tapipop -c 10 &#39;ip host 192.168.10.10&#39;<br />
				<br />
				On Alice, send five ICMP packets to Bob, with the payload &quot;deadbeef&quot; (a pattern that will make it easier to observe at the output of tcpdump):<br />
				<br />
				ping -p deadbeef -c 5 192.168.10.20<br />
				<br />
				On Bob, you should see tcpdump output that looks like this:<br />
				<br />
				
					11:41:55.084606 IP ip-192-168-10-10.ec2.internal &gt; ip-192-168-10-20.ec2.internal:<br />
					ESP(spi=0x03ae3438,seq=0x1c), length 100<br />
					0x0000: &nbsp;4500 0078 0000 4000 4032 a4e5 c0a8 0a0a &nbsp;E..x..@.@2......<br />
					0x0010: &nbsp;c0a8 0a14 03ae 3438 0000 001c b7b9 013a &nbsp;......48.......:<br />
					0x0020: &nbsp;7f0d ff58 7968 2f35 7997 08d1 7a0f 8f00 &nbsp;...Xyh/5y...z...<br />
					0x0030: &nbsp;f004 1721 f902 3545 7263 ca5f bd9c 0724 &nbsp;...!..5Erc._...$<br />
					0x0040: &nbsp;d2cf df0e b097 470a 862e ac50 6c95 c755 &nbsp;......G....Pl..U<br />
					0x0050: &nbsp;0ebb 0283 0633 4f98 0578 ec8f 6e09 aadf &nbsp;.....3O..x..n...<br />
					0x0060: &nbsp;e120 4806 d914 7d2c 4ccc 643f 6269 8f92 &nbsp;..H...},L.d?bi..<br />
					0x0070: &nbsp;f3df 4a70 cfde 80a6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;..Jp....
				<br />
				<br />
				The tcpdump output tells you that the packet is ESP, which stands for Encapsulated Security Payload. Note that you don&#39;t see the &quot;deadbeef&quot; pattern, as there is privacy in the communicaiton - nodes in the path between Alice and Bob will not be able to see the payload of any IP packet they communicate.<br />
				<br />
				<em><strong>3.5) Inspecting IPsec authentication</strong></em><br />
				<br />
				Now let&#39;s show how IPsec prevents non-authenticated nodes to communicate. Disable IPsec by running the following commands, <em>on Bob, as root:</em><br />
				<br />
				/etc/init.d/racoon stop<br />
				
					setkey -F<br />
					setkey -FP
				
					<br />
					<br />
					Then, try to ping Alice from Bob, or vice-versa. You will see that packets do not flow now.
				<br />
				<br />
				<em><strong>3.6) Inspecting packets without IPsec</strong></em><br />
				<br />
				<br />
				Now let&#39;s show how, without IPsec, the payload is not kept private. Disable IPsec, <em>on Alice, as root:</em><br />
				<br />
				/etc/init.d/racoon stop<br />
				setkey -F<br />
				setkey -FP
				
					<br />
					<br />
					<em>On Bob</em>, run tcpdump to capture and show a count of ten packets sent/received to/from Alice&#39;s IP in the tapipop interface:<br />
					&nbsp;<br />
					tcpdump -X -i tapipop -c 10 &#39;ip host 192.168.10.10&#39;<br />
					<br />
					<em>On Alice</em>, send five ICMP packets to Bob, with the payload &quot;deadbeef&quot; (a pattern that will make it easier to observe at the output of tcpdump):<br />
					&nbsp;<br />
					ping -p deadbeef -c 5 192.168.10.20<br />
					<br />
					On Bob, you should now see tcpdump output that looks like this:
				
					<br />
					<br />
					11:46:10.258390 IP ip-192-168-10-10.ec2.internal &gt; ip-192-168-10-20.ec2.internal:<br />
					ICMP echo request, id 6107, seq 5, length 64<br />
					0x0000: &nbsp;4500 0054 0000 4000 4001 a53a c0a8 0a0a &nbsp;E..T..@.@..:....<br />
					0x0010: &nbsp;c0a8 0a14 0800 e859 17db 0005 825e 9b51 &nbsp;.......Y.....^.Q<br />
					0x0020: &nbsp;0000 0000 aeed 0300 0000 0000 dead beef &nbsp;................<br />
					0x0030: &nbsp;dead beef dead beef dead beef dead beef &nbsp;................<br />
					0x0040: &nbsp;dead beef dead beef dead beef dead beef &nbsp;................<br />
					0x0050: &nbsp;dead beef &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;....
				<br />
				<br />
				And you can discern the &quot;deadbeef&quot; pattern in the packet now that it is no longer encrypted by IPsec.<br />
				<br />
				<br />
				<em><strong>Troubleshooting and for more information</strong></em><br />
				<br />
				If you find connectivity problems when running this tutorial, you can try restarting the IPOP process by running:<br />
				<br />
				/etc/init.d/groupvpn.sh stop<br />
				/etc/init.d/groupvpn.sh start<br />
				<br />
				And stopping IPsec:<br />
				setkey -F<br />
				setkey -FP<br />
				/etc/init.d/racoon stop<br />
				<br />
				If you run into problems that do not seem to go away, or are interested in using IPOP and would like to learn more about advanced configuration and deployment, please contact the IPOP team by joining the ACIS P2P Users malining list at: acisp2p [at] googlegroups [dot] com, or contact Renato Figueiredo at: renato [at] acis [dot] ufl [dot] edu.  </div>

  <ul class="links inline"><li class="comment_forbidden login-or-register-to-post-comments first last"><span><a href="/user/login?destination=comment%2Freply%2F2522%23comment-form">Login</a> or <a href="/user/register?destination=comment%2Freply%2F2522%23comment-form">register</a> to post comments</span></li>
</ul></div><!-- /.node -->
        </div>

        
        
      </div></div><!-- /.section, /#content -->

              <div id="navigation"><div class="section clearfix">

          
          <div class="region region-navigation">
  <div id="block-menu-menu-website" class="block block-menu first last region-odd odd region-count-1 count-1">
  
  <div class="content">
    <ul class="menu"><li class="expanded about first"><a href="/about" title="">About</a><ul class="menu"><li class="leaf overview first"><a href="https://portal.futuregrid.org/about" title="">Overview</a></li>
<li class="leaf status"><a href="/status" title="">Status</a></li>
<li class="collapsed news"><a href="/news">News</a></li>
<li class="expanded documents"><a href="/documents" title="">Documents</a><ul class="menu"><li class="leaf manuals first"><a href="/manual" title="">Manuals</a></li>
<li class="leaf tutorials"><a href="/tutorials" title="">Tutorials</a></li>
<li class="collapsed presentations"><a href="/documents/presentations" title="">Presentations</a></li>
<li class="leaf publications"><a href="/documents/publications" title="">Publications</a></li>
<li class="leaf reports last"><a href="/reports" title="">Reports</a></li>
</ul></li>
<li class="leaf sponsors"><a href="/sponsors" title="">Sponsors</a></li>
<li class="leaf staff"><a href="/staff" title="">Staff</a></li>
<li class="leaf contact last"><a href="/contact" title="">Contact</a></li>
</ul></li>
<li class="expanded support"><a href="/manual/help-and-support" title="">Support</a><ul class="menu"><li class="leaf getting-started first"><a href="/manual/gettingstarted" title="">Getting Started</a></li>
<li class="leaf accessing-futuregrid"><a href="/manual/access" title="">Accessing FutureGrid</a></li>
<li class="expanded user-manual"><a href="/manual" title="">User Manual</a><ul class="menu"><li class="leaf table-of-contents first last"><a href="/manual/toc" title="">Table of Contents</a></li>
</ul></li>
<li class="expanded faq"><a href="/faq" title="">FAQ</a><ul class="menu"><li class="leaf all-entries first"><a href="https://portal.futuregrid.org/faq" title="">All Entries</a></li>
<li class="leaf ask-a-question last"><a href="https://portal.futuregrid.org/node/add/faq?ask=TRUE" title="">Ask a Question</a></li>
</ul></li>
<li class="expanded tutorials"><a href="/tutorials" title="">Tutorials</a><ul class="menu"><li class="expanded summer-school first last"><a href="https://portal.futuregrid.org/projects/241" title="">Summer School</a><ul class="menu"><li class="leaf tumblr first"><a href="http://sciencecloudsummer2012.tumblr.com/schedule" title="">tumblr</a></li>
<li class="leaf project-page"><a href="https://portal.futuregrid.org/projects/241" title="">Project Page</a></li>
<li class="leaf forum"><a href="https://portal.futuregrid.org/forums/fg-class-and-tutorial-forums/summer-school-2012" title="">Forum</a></li>
<li class="leaf account-creation"><a href="https://portal.futuregrid.org/projects/241/register" title="">Account Creation</a></li>
<li class="leaf next-steps"><a href="https://portal.futuregrid.org/projects/241/next" title="">Next Steps</a></li>
<li class="leaf participants last"><a href="https://portal.futuregrid.org/projects/241/participants" title="">Participants</a></li>
</ul></li>
</ul></li>
<li class="leaf using-iaas-clouds"><a href="/using/clouds" title="">Using IaaS Clouds</a></li>
<li class="leaf using-map-reduce"><a href="/using/mapreduce" title="">Using Map/Reduce</a></li>
<li class="leaf forums"><a href="https://portal.futuregrid.org/forum" title="">Forums</a></li>
<li class="leaf my-tickets"><a href="/tickets" title="">My tickets</a></li>
<li class="leaf submit-a-ticket last"><a href="/help" title=""><span class="tab">Submit a ticket</span></a></li>
</ul></li>
<li class="expanded community"><a href="/community" title="">Community</a><ul class="menu"><li class="leaf can-i-help first"><a href="/contrib/can-i-help" title="Can I Help?">Can I Help?</a></li>
<li class="collapsed forum"><a href="/forum" title="">Forum</a></li>
<li class="leaf add-a-community-page"><a href="https://portal.futuregrid.org/node/add/page-community" title="">Add a Community Page</a></li>
<li class="leaf add-a-project-publication"><a href="/fg/publication/add" title="Add a publication produced by a project">Add a Project Publication</a></li>
<li class="leaf educational-materials"><a href="/community_edu_materials" title="">Educational Materials</a></li>
<li class="leaf moocs"><a href="/massive-open-online-courses-moocs-futuregrid" title="Massively Open Online Courses">MOOCs</a></li>
<li class="leaf multimedia-gallery"><a href="/gallery/science-cloud-summer-school" title="FutureGrid Multimedia Gallery">Multimedia Gallery</a></li>
<li class="leaf virtual-appliances last"><a href="/community/appliances" title="">Virtual Appliances</a></li>
</ul></li>
<li class="expanded projects last"><a href="/projects/overview" title="">Projects</a><ul class="menu"><li class="expanded project-lists first"><a href="/projects/all" title="">Project Lists</a><ul class="menu"><li class="leaf all-projects first"><a href="/projects/all" title="">All Projects</a></li>
<li class="leaf course-projects"><a href="/projects/keywords/course" title="">Course Projects</a></li>
<li class="leaf xsede-projects last"><a href="/projects-xsede" title="Projects originated from XSEDE via AMIE or XSEDE related projects from FG portal">XSEDE Projects</a></li>
</ul></li>
<li class="leaf project-keywords"><a href="/projects/keywords" title="">Project Keywords</a></li>
<li class="leaf statistics"><a href="https://portal.futuregrid.org/projects-statistics" title="">Statistics</a></li>
<li class="expanded results last"><a href="/projects/list/results" title="">Results</a><ul class="menu"><li class="leaf add-a-publication first"><a href="/fg/publication/add" title="Adds a project publication">Add a Publication</a></li>
<li class="leaf how-to-report-results"><a href="/faq/how-do-i-report-results" title="A link to an FAQ that explains how to report results">How to Report Results?</a></li>
<li class="leaf how-to-close-a-project last"><a href="https://portal.futuregrid.org/faq/how-do-i-close-project" title="">How to Close a Project?</a></li>
</ul></li>
</ul></li>
</ul>  </div>

  </div><!-- /.block -->
</div><!-- /.region -->

        </div></div><!-- /.section, /#navigation -->
      
      
            
            	<div id="page-bottom"><div class="region region-page-bottom">
  <div id="block-menu_block-1" class="block block-menu_block first region-odd odd region-count-1 count-3">
      <h2 class="title"><a href="/about" title="">About</a></h2>
  
  <div class="content">
    <div class="menu_block_wrapper menu-block-1 menu-name-menu-website parent-mlid-2705 menu-level-1">
  <ul class="menu"><li class="leaf overview first menu-mlid-2706"><a href="https://portal.futuregrid.org/about" title="">Overview</a></li>
<li class="leaf status menu-mlid-2708"><a href="/status" title="">Status</a></li>
<li class="leaf news menu-mlid-1025 has-children"><a href="/news">News</a></li>
<li class="leaf documents menu-mlid-11541 has-children"><a href="/documents" title="">Documents</a></li>
<li class="leaf sponsors menu-mlid-2709"><a href="/sponsors" title="">Sponsors</a></li>
<li class="leaf staff menu-mlid-5799"><a href="/staff" title="">Staff</a></li>
<li class="leaf contact last menu-mlid-2710"><a href="/contact" title="">Contact</a></li>
</ul></div>
  </div>

  </div><!-- /.block -->
<div id="block-menu_block-3" class="block block-menu_block region-even even region-count-2 count-4">
      <h2 class="title"><a href="/manual/help-and-support" title="">Support</a></h2>
  
  <div class="content">
    <div class="menu_block_wrapper menu-block-3 menu-name-menu-website parent-mlid-2051 menu-level-1">
  <ul class="menu"><li class="leaf getting-started first menu-mlid-11542"><a href="/manual/gettingstarted" title="">Getting Started</a></li>
<li class="leaf accessing-futuregrid menu-mlid-20373"><a href="/manual/access" title="">Accessing FutureGrid</a></li>
<li class="leaf user-manual menu-mlid-2571 has-children"><a href="/manual" title="">User Manual</a></li>
<li class="leaf faq menu-mlid-1671 has-children"><a href="/faq" title="">FAQ</a></li>
<li class="leaf tutorials menu-mlid-3939 has-children"><a href="/tutorials" title="">Tutorials</a></li>
<li class="leaf using-iaas-clouds menu-mlid-14005"><a href="/using/clouds" title="">Using IaaS Clouds</a></li>
<li class="leaf using-map-reduce menu-mlid-14002"><a href="/using/mapreduce" title="">Using Map/Reduce</a></li>
<li class="leaf forums menu-mlid-14831"><a href="https://portal.futuregrid.org/forum" title="">Forums</a></li>
<li class="leaf my-tickets menu-mlid-14830"><a href="/tickets" title="">My tickets</a></li>
<li class="leaf submit-a-ticket last menu-mlid-14829"><a href="/help" title=""><span class="tab">Submit a ticket</span></a></li>
</ul></div>
  </div>

  </div><!-- /.block -->
<div id="block-menu_block-4" class="block block-menu_block region-odd odd region-count-3 count-5">
      <h2 class="title"><a href="/community" title="">Community</a></h2>
  
  <div class="content">
    <div class="menu_block_wrapper menu-block-4 menu-name-menu-website parent-mlid-13995 menu-level-1">
  <ul class="menu"><li class="leaf can-i-help first menu-mlid-23554"><a href="/contrib/can-i-help" title="Can I Help?">Can I Help?</a></li>
<li class="leaf forum menu-mlid-1084 has-children"><a href="/forum" title="">Forum</a></li>
<li class="leaf add-a-community-page menu-mlid-14001"><a href="https://portal.futuregrid.org/node/add/page-community" title="">Add a Community Page</a></li>
<li class="leaf add-a-project-publication menu-mlid-14996"><a href="/fg/publication/add" title="Add a publication produced by a project">Add a Project Publication</a></li>
<li class="leaf educational-materials menu-mlid-13997"><a href="/community_edu_materials" title="">Educational Materials</a></li>
<li class="leaf moocs menu-mlid-29750"><a href="/massive-open-online-courses-moocs-futuregrid" title="Massively Open Online Courses">MOOCs</a></li>
<li class="leaf multimedia-gallery menu-mlid-30279"><a href="/gallery/science-cloud-summer-school" title="FutureGrid Multimedia Gallery">Multimedia Gallery</a></li>
<li class="leaf virtual-appliances last menu-mlid-14910"><a href="/community/appliances" title="">Virtual Appliances</a></li>
</ul></div>
  </div>

  </div><!-- /.block -->
<div id="block-menu_block-5" class="block block-menu_block last region-even even region-count-4 count-6">
      <h2 class="title"><a href="/projects/overview" title="">Projects</a></h2>
  
  <div class="content">
    <div class="menu_block_wrapper menu-block-5 menu-name-menu-website parent-mlid-1295 menu-level-1">
  <ul class="menu"><li class="leaf project-lists first menu-mlid-29647 has-children"><a href="/projects/all" title="">Project Lists</a></li>
<li class="leaf project-keywords menu-mlid-29648"><a href="/projects/keywords" title="">Project Keywords</a></li>
<li class="leaf statistics menu-mlid-14019"><a href="https://portal.futuregrid.org/projects-statistics" title="">Statistics</a></li>
<li class="leaf results last menu-mlid-4602 has-children"><a href="/projects/list/results" title="">Results</a></li>
</ul></div>
  </div>

  </div><!-- /.block -->
</div><!-- /.region -->
</div>
      
    </div></div><!-- /#main, /#main-wrapper -->

          <div id="footer"><div class="section">

        
                  <div id="footer-message"><a href="http://www.tacc.utexas.edu/" target="_blank" title="Texas Advanced Computing Center"><img alt="" height="100" src="/sites/default/files/images/nsf-logo.png" width="100" /></a>The FutureGrid project is funded by the National Science Foundation (NSF) and is led by <a href="http://www.iub.edu/" target="_blank" title="Indiana University - Bloomington">Indiana University</a> with <a href="http://www.uchicago.edu/index.shtml" target="_blank" title="University of Chicago">University of Chicago</a>, <a href="http://www.ufl.edu/" target="_blank" title="University of Florida">University of Florida</a>, <a href="http://www.sdsc.edu/" target="_blank" title="San Diego Supercomputing Center">San Diego Supercomputing Center</a>, <a href="http://www.tacc.utexas.edu/" target="_blank" title="Texas Advanced Computing Center">Texas Advanced Computing Center</a>, <a href="http://www.virginia.edu/">University of Virginia</a>, <a href="http://www.utk.edu/" target="_blank" title="University of Tennessee">University of Tennessee</a>, <a href="http://www3.isi.edu/home" target="_blank" title="University of California - Information Sciences Institute">University of Southern California</a>, <a href="http://tu-dresden.de">Dresden</a>, <a href="http://www.purdue.edu/" target="_blank" title="Purdue University">Purdue University</a>, and <a href="https://www.grid5000.fr/mediawiki/index.php/Grid5000:Home" target="_blank" title="Grid&#039;5000">Grid 5000</a> as partner sites. This material is based upon work supported in part by the National Science Foundation under Grant No. 0910812.<br />
<br />
<br />
<br />
<br />
<br />
<img alt="" height="75" src="/sites/default/files/u876/xsede-logo.png" width="250" />Futuregrid is a resource provider for <a href="https://www.xsede.org/">XSEDE</a>. </div>
        
        
      </div></div><!-- /.section, /#footer -->
    
  </div></div><!-- /#page, /#page-wrapper -->

  
  <script type="text/javascript" src="/sites/default/files/js/js_6ad8b4a3f60ccf801ab37de1f71526c1.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "googleCSE": { "language": "en" } });
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-19447157-2"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script");ga.type = "text/javascript";ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);})();
//--><!]]>
</script>

</body>
</html>
