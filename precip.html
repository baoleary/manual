<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Precip &mdash; Cloud Computing Book 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.2/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/cosmo/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.2/css/bootstrap-responsive.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Cloud Computing Book 0.1 documentation" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="index.html">Contents</a>
        <span class="navbar-text pull-left"><b>0.1</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
              <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul>
<li class="toctree-l1"><a class="reference internal" href="preface.html">1. Preface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preface.html#citation-for-publications">1.1. Citation for Publications</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#acknowledgement">1.2. Acknowledgement</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#sponsors">1.3. Sponsors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#about-this-manual">1.4. About this Manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#conventions">1.5. Conventions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">2. Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#executive-summary">2.1. Executive Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#project-and-account-application">2.2. Project and Account Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#services">2.3. Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#hardware">2.4. Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#support">2.5. Support</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="account.html">1. Project and Account Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="account.html#terminology">1.1. Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="account.html#quickstart">1.2. Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="account.html#projects-and-accounts-for-xsede-users">1.3. Projects and Accounts for XSEDE users</a></li>
<li class="toctree-l2"><a class="reference internal" href="account.html#project-management">1.4. Project Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="account.html#upload-a-ssh-public-key">1.5. Upload a SSH Public Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="account.html#upload-an-openid">1.6. Upload an OpenId</a></li>
<li class="toctree-l2"><a class="reference internal" href="account.html#accessing-futuregrid-resources">1.7. Accessing FutureGrid Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="account.html#manage-a-class-on-futuregrid">1.8. Manage a Class on FutureGrid</a></li>
<li class="toctree-l2"><a class="reference internal" href="account.html#mini-faq">1.9. Mini FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="security.html">2. Using SSH Keys</a><ul>
<li class="toctree-l2"><a class="reference internal" href="security.html#using-ssh-from-windows">2.1. Using SSH from Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html#generate-a-ssh-key">2.2. Generate a SSH key</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html#add-or-replace-passphrase-for-an-already-generated-key">2.3. Add or Replace Passphrase for an Already Generated Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html#upload-the-key-to-the-futuregrid-portal">2.4. Upload the key to the FutureGrid Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html#testing-your-ssh-key">2.5. Testing your ssh key</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html#testing-your-ssh-key-for-hotel">2.6. Testing your ssh key for Hotel</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="status.html">1. Status</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hardware.html">1. Hardware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hardware.html#compute-resources">1.1. Compute Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware.html#networks">1.2. Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware.html#network-impairments-device-nid">1.3. Network Impairments Device (NID)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hpc.html">2. HPC Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hpc.html#login-nodes">2.1. Login Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="hpc.html#message-passing-interface-mpi">2.2. Message Passing Interface (MPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="hpc.html#job-management">2.3. Job Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="hpc.html#xray-hpc-services">2.4. Xray HPC Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scalemp.html">3. ScaleMP vSMP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scalemp.html#accessing-scalemp">3.1. Accessing ScaleMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="scalemp.html#submitting-a-job">3.2. Submitting a job</a></li>
<li class="toctree-l2"><a class="reference internal" href="scalemp.html#developing-a-job-script">3.3. Developing a job script</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="iaas.html">1. IaaS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="iaas.html#nimbus-clouds">1.1. Nimbus Clouds</a></li>
<li class="toctree-l2"><a class="reference internal" href="iaas.html#openstack-clouds">1.2. OpenStack Clouds</a></li>
<li class="toctree-l2"><a class="reference internal" href="iaas.html#eucalyptus-clouds">1.3. Eucalyptus Clouds</a></li>
<li class="toctree-l2"><a class="reference internal" href="iaas.html#virtual-appliances-for-training-and-education">1.4. Virtual Appliances for Training and Education</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="openstack.html">2. OpenStack Essex with euca2ools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#prerequisites">2.1. Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#log-into-india">2.2. Log into India</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#system-variable-user">2.3. System Variable $USER</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#account-and-credentials">2.4. Account and Credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#euca2ools-ec2-client-tools">2.5. Euca2ools (EC2 client tools)</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#testing-your-setup">2.6. Testing Your Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#list-of-common-images">2.7. List of Common Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#vm-types">2.8. VM Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#key-management">2.9. Key Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#image-instantiation">2.10. Image Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#rename-server-names">2.11. Rename Server Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#monitoring-instances">2.12. Monitoring Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#log-into-your-vm">2.13. Log into your VM</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#nova-volumes-not-available">2.14. Nova Volumes (Not available)</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#volume-snapshots">2.15. Volume Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#image-registration">2.16. Image Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#delete-your-images">2.17. Delete your images</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#terminate-your-vms">2.18. Terminate your VMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#limitations">2.19. Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#troubleshooting">2.20. Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#compatibility-between-nova-and-euca2ools-commands">2.21. Compatibility between nova and euca2ools commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="openstack-grizzly.html">3. OpenStack Grizzly</a><ul>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly.html#use-block-storage">3.1. Use Block Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly.html#set-up-external-access-to-your-instance">3.2. Set up external access to your instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly.html#make-a-snapshot-of-an-instance">3.3. Make a snapshot of an instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly.html#automate-some-initial-configuration">3.4. Automate some initial configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly.html#get-the-latest-version-of-ubuntu-cloud-image-and-upload-it-to-the-openstack">3.5. Get the latest version of Ubuntu Cloud Image and upload it to the OpenStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly.html#delete-your-instance">3.6. Delete your instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly.html#how-to-change-your-password">3.7. How to change your password</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly.html#things-to-do-when-you-need-euca2ools-or-ec2-interfaces">3.8. Things to do when you need Euca2ools or EC2 interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="eucalyptus.html">5. Eucalyptus</a><ul>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#account-creation">5.1. Account Creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#resources-overview">5.2. Resources Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#testing-your-setup">5.3. Testing Your Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#image-deployment">5.4. Image Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#logging-into-the-vm">5.5. Logging Into the VM</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#vm-network-info">5.6. VM Network Info</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#image-management">5.7. Image Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#status-of-deployments">5.8. Status of Deployments</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rain.html">4. RAIN</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rain.html#generate-and-register-an-os-image-on-futuregrid-using-the-fg-shell">4.1. Generate and Register an OS Image on FutureGrid using the FG Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="rain.html#futuregrid-standalone-image-repository">4.2. FutureGrid Standalone Image Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="rain.html#manual-image-customization">4.3. Manual Image Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="rain.html#rain-manual-pages">4.4. RAIN Manual Pages</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mooc/accounts.html">1. Screencast: Account and Project Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mooc/accounts.html#overview">1.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mooc/accounts.html#prerequisites">1.2. Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="mooc/accounts.html#instructor-bio">1.3. Instructor Bio</a></li>
<li class="toctree-l2"><a class="reference internal" href="mooc/accounts.html#faq">1.4. FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="mooc/accounts.html#course-content">1.5. Course Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="mooc/accounts.html#exercises">1.6. Exercises</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="todolist.html">1. Todo List</a></li>
<li class="toctree-l1"><a class="reference internal" href="plan.html">2. Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">13. Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">11. Building the Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#python">11.1. Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#virtualenv">11.2. Virtualenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#create-a-github-local-directory-with-the-manual">11.3. Create a github local directory with the manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#install-the-requirements">11.4. Install the Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#all-in-one-setup-script">11.5. All-in-one setup script</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#watchdog">11.6. Watchdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#transfering-a-page-from-the-portal-to-rst">11.7. Transfering a page from the portal to RST</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#creating-the-pages-locally">11.8. Creating the pages locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#publishing-the-pages">11.9. Publishing the pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#jira">11.10. jira</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#portal-link">11.11. Portal link</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#screencast-recording-tips">11.12. Screencast recording tips</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mooc.html">5. Template: Module/Unit Title</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mooc.html#overview">5.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mooc.html#prerequisites">5.2. Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="mooc.html#instructor-bio">5.3. Instructor Bio</a></li>
<li class="toctree-l2"><a class="reference internal" href="mooc.html#faq">5.4. FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="mooc.html#course-content">5.5. Course Content</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ring.html">1. MPI Ring Program</a></li>
</ul>
</ul>
</li>
              <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">3. Precip</a><ul>
<li><a class="reference internal" href="#installation">3.1. Installation</a></li>
<li><a class="reference internal" href="#api">3.2. API</a></li>
<li><a class="reference internal" href="#examples">3.3. Examples</a><ul>
<li><a class="reference internal" href="#hello-world">3.3.1. Hello World</a></li>
<li><a class="reference internal" href="#resources-from-mulitple-infrastructures">3.3.2. Resources from mulitple infrastructures</a></li>
<li><a class="reference internal" href="#setting-up-a-condor-pool-and-run-a-pegasus-workflow">3.3.3. Setting up a Condor pool and run a Pegasus workflow</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
            
            
              
            
            
              <li>
  <a href="_sources/precip.txt"
     rel="nofollow">Source</a></li>
            
          </ul>

          
            
<form class="navbar-search pull-right" action="search.html" method="get">
  <input type="text" name="q" class="search-query" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  
  <div class="section" id="precip">
<h1>3. Precip<a class="headerlink" href="#precip" title="Permalink to this headline">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">Page Contents</p>
<div class="contents local last topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#installation" id="id1">Installation</a></li>
<li><a class="reference internal" href="#api" id="id2">API</a></li>
<li><a class="reference internal" href="#examples" id="id3">Examples</a><ul>
<li><a class="reference internal" href="#hello-world" id="id4">Hello World</a></li>
<li><a class="reference internal" href="#resources-from-mulitple-infrastructures" id="id5">Resources from mulitple infrastructures</a></li>
<li><a class="reference internal" href="#setting-up-a-condor-pool-and-run-a-pegasus-workflow" id="id6">Setting up a Condor pool and run a Pegasus workflow</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>The Pegasus Repeatable Experiments for the Cloud in Python (Precip), is a flexible exeperiment management API for running experiments on clouds. Precip was developed for use on FutureGrid infrastructures such as OpenStack, Eucalyptus (&gt;=3.2), Nimbus, and at the same time commercial clouds such as Amazon EC2. The API allows you to easily provision resources, which you can then can run commands on and copy files to/from subsets of instances identified by tags. The goal of the API is to be flexible and simple to use in Python scripts to control your experiments.</p>
<p>The API does not require any special images, which makes it easy to get
going. Any basic Linux image will work. More complex images can be used
if your experiment requires so, or you can use the experiment API to run
bootstrap scripts on the images to install/configure required software.</p>
<p>A concept which simplfies interacting with the API is instance tagging.
When you start an instance, you can add arbitrary tags to it. The
instance also gets a set of default tags. API methods such as running a
remote command, or copying files, all use tags for specify which
instances you want to target.</p>
<p>Precip also handles ssh keys and security groups automatically. This is
done to make sure the experiment management is not interfering with your
existing cloud setup. The first time you use Precip, a directory will be
created called ~/.precip. Inside this directory, a ssh keypair will be
created and used for accessing instances. On clouds which supports it,
the keypair is automatically registered as &#8216;precip&#8217;, and a &#8216;precip&#8217;
security group is created. If your experiement requires more ports to be
open you can use the cloud interface to add those ports to the precip
security group.</p>
<p>Precip is a fairly new API, and if you have questions or suggestions for
improvements, please contact
<a class="reference external" href="mailto:pegasus-support&#37;&#52;&#48;isi&#46;edu">pegasus-support<span>&#64;</span>isi<span>&#46;</span>edu</a></p>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id1">3.1. Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>If you want to use the India or Sierra FutureGrid resources to manage
your experiment, Precip is available on the interactive logins nodes via
modules: module load precip/0.1</p>
<p>You can also install Precip on your own machine. Prerequisites are
the Paramiko and Boto Python modules. The Python source package and RPMs
are available at:
<a class="reference external" href="http://pegasus.isi.edu/static/precip/software/">http://pegasus.isi.edu/static/precip/software/</a></p>
</div>
<div class="section" id="api">
<h2><a class="toc-backref" href="#id2">3.2. API</a><a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><strong>provision(image_id, instance_type=&#8217;m1.small&#8217;, count=1, tags=None)</strong></dt>
<dd><p class="first">Provision a new instance. Note that this method starts the
provisioning cycle, but does not block for the instance to finish
booting. For blocking on instance creation/booting, see wait()</p>
<p>Parameters:</p>
<ul class="last simple">
<li><strong>image_id</strong> - the id of the image to instanciate</li>
<li><strong>instance_type</strong> - the type of instance. This is infrastructure
specific, but usually follows the Amazon EC2 model with m1.small,
m1.large, and so on.</li>
<li><strong>count</strong> - number of instances to create</li>
<li><strong>tags</strong> - these are used to manipulate the instance later. Use
this to create logical groups of your instances.</li>
</ul>
</dd>
<dt><strong>wait(tags=[], timeout=600)</strong></dt>
<dd><p class="first">Barrier for all instances matching the tags argument. This method
will block until the instances have finish booting and are
accessible via their external hostnames.</p>
<p>Parameters:</p>
<ul class="last simple">
<li><strong>tags</strong> - tags specifying the subset of instances to block on.
The default value is [] which means wait for all instances.</li>
<li><strong>timeout</strong> - timeout in seconds for the instances to boot. If
the timeout is reached, an ExperimentException is raised. The
default is 600 seconds.</li>
</ul>
</dd>
<dt><strong>deprovision(tags)</strong></dt>
<dd><p class="first">Deprovisions (terminates) instances matching the tags argument</p>
<p>Parameters:</p>
<ul class="last simple">
<li><strong>tags</strong> - tags specifying the subset of instances to
deprovision.</li>
</ul>
</dd>
<dt><strong>list(tags)</strong></dt>
<dd><p class="first">Returns a list of details about the instances matching the tags. The
details include instance id, hostnames, and tags.</p>
<p>Parameters:</p>
<ul class="simple">
<li><strong>tags</strong> - tags specifying the subset of instances to give
information on. If you want details on all current instances, use
[].</li>
</ul>
<p>Returns:</p>
<ul class="last simple">
<li>List of dictionaries, one for each instance.</li>
</ul>
</dd>
<dt><strong>get_public_hostnames(tags)</strong></dt>
<dd><p class="first">Provides a list of public hostnames for the instances matching the
tags. The public hostnames can be provided to other instances in
order to let the instances know about eachother.</p>
<p>Parameters:</p>
<ul class="simple">
<li><strong>tags</strong> - tags specifying the subset of instances.</li>
</ul>
<p>Returns:</p>
<ul class="last simple">
<li>A list of public hostnames</li>
</ul>
</dd>
<dt><strong>get_private_hostnames(tags)</strong></dt>
<dd><p class="first">Provides a list of private hostnames for the instances matching the
tags. The private hostnames can be provided to other instances in
order to let the instances know about eachother.</p>
<p>Parameters:</p>
<ul class="simple">
<li><strong>tags</strong> - tags specifying the subset of instances.</li>
</ul>
<p>Returns:</p>
<ul class="last simple">
<li>A list of private hostnames</li>
</ul>
</dd>
<dt><strong>get(tags, remote_path, local_path, user=&#8221;root&#8221;)</strong></dt>
<dd><p class="first">Transfers a file from a set of remote machines matching the tags,
and stores the file locally. If more than one instance matches the
tags, an instance id will be appended to the local_path.</p>
<p>Parameters:</p>
<ul class="last simple">
<li><strong>tags</strong> - these are used to manipulate the instance later. Use
this to create logical groups of your instances.</li>
<li><strong>remote_path</strong> - the path of the file on the remote instance</li>
<li><strong>local_path</strong> - the local path to tranfer to</li>
<li><strong>user</strong> - remote user. If not specified, the default is &#8216;root&#8217;</li>
</ul>
</dd>
<dt><strong>put(tags, local_path, remote_path, user=&#8221;root&#8221;)</strong></dt>
<dd><p class="first">Transfers a local file to a set of remote machines matching the
tags.</p>
<p>Parameters:</p>
<ul class="last simple">
<li><strong>tags</strong> - these are used to manipulate the instance later. Use
this to create logical groups of your instances.</li>
<li><strong>local_path</strong> - the local path to tranfer from</li>
<li><strong>remote_path</strong> - the path on the remote instance to store the
file as</li>
<li><strong>user</strong> - remote user. If not specified, the default is &#8216;root&#8217;</li>
</ul>
</dd>
<dt><strong>run(tags, cmd, user=&#8221;root&#8221;, check_exit_code=True)</strong></dt>
<dd><p class="first">Runs a command on the instances matches the tags. The commands are
run in series, on one instance after the other.</p>
<p>Parameters:</p>
<ul class="simple">
<li><strong>tags</strong> - these are used to manipulate the instance later. Use
this to create logical groups of your instances.</li>
<li><strong>cmd</strong> - the command to run</li>
<li><strong>user</strong> - remote user. If not specified, the default is &#8216;root&#8217;.
If you need to run commands as another user, you will have to
make sure that user accepts the ssh key in ~/.precip/</li>
<li><strong>check_exit_code</strong> - If set to True (default), commands
returning non-zero exit codes will result in a
ExperimentException being raised.</li>
</ul>
<p>Returns:</p>
<ul class="last simple">
<li>A list of lists, containing exit_code[], stdout[] and stderr[]
for the commands run</li>
</ul>
</dd>
</dl>
<p><strong>copy_and_run(tags, local_script, args=[], user=&#8221;root&#8221;,
check_exit_code=True)</strong></p>
<blockquote>
<div><p>Copies a script from the local machine to the remote instances and
executes the script. The script is run in series, on one instance
after the other.</p>
<p>Parameters:</p>
<ul class="simple">
<li><strong>tags</strong> - these are used to manipulate the instance later. Use
this to create logical groups of your instances.</li>
<li><strong>local_script</strong> - the local script to run</li>
<li><strong>args</strong> - arguments for the script</li>
<li><strong>user</strong> - remote user. If not specified, the default is &#8216;root&#8217;.
If you need to run commands as another user, you will have to
make sure that user accepts the ssh key in ~/.precip/</li>
<li><strong>check_exit_code</strong> - If set to True (default), commands
returning non-zero exit codes will result in a
ExperimentException being raised.</li>
</ul>
<p>Returns:</p>
<ul class="simple">
<li>A list of lists, containing exit_code[], stdout[] and stderr[]
for the commands run</li>
</ul>
</div></blockquote>
<p>The basic methods above are standard across all the Cloud
infrastructures. What is different is the constructors as each
infrastructure handles initialization a little bit different. For
example, to create a new OpenStack using the EC2_* environment
provided automatically by FutureGrid:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exp</span> <span class="o">=</span> <span class="n">OpenStackExperiment</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;EC2_URL&#39;</span><span class="p">],</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;EC2_ACCESS_KEY&#39;</span><span class="p">],</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;EC2_SECRET_KEY&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>i For Amazon EC2, you have to specify region, endpoint, and
access/secret keys. Note that it is not required to use environment
variables for your credentials, but seperating the crenditals from the
code prevents the credentials from being check in to source control
systems:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exp</span> <span class="o">=</span> <span class="n">EC2Experiment</span><span class="p">(</span>
        <span class="s">&quot;us-west-2c&quot;</span><span class="p">,</span>
        <span class="s">&quot;ec2.us-west-2.amazonaws.com&quot;</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;AMAZON_EC2_ACCESS_KEY&#39;</span><span class="p">],</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;AMAZON_EC2_SECRET_KEY&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id3">3.3. Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hello-world">
<h3><a class="toc-backref" href="#id4">3.3.1. Hello World</a><a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">from</span> <span class="nn">precip</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">exp</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c"># Use try/except liberally in your experiments - the api is set up to</span>
<span class="c"># raise ExperimentException on most errors</span>
<span class="k">try</span><span class="p">:</span>

    <span class="c"># Create a new OpenStack based experiment. In this case we pick</span>
    <span class="c"># up endpoints and access/secret cloud keys from the environment</span>
    <span class="c"># as exposing those is the common setup on FutureGrid</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="n">OpenStackExperiment</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;EC2_URL&#39;</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;EC2_ACCESS_KEY&#39;</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;EC2_SECRET_KEY&#39;</span><span class="p">])</span>

    <span class="c"># Provision an instance based on the ami-0000004c. Note that tags are</span>
    <span class="c"># used throughout the api to identify and manipulate instances. You</span>
    <span class="c"># can give an instance an arbitrary number of tags.</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">provision</span><span class="p">(</span><span class="s">&quot;ami-0000004c&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;test1&quot;</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># Wait for all instances to boot and become accessible. The provision</span>
    <span class="c"># method only starts the provisioning, and can be used to start a large</span>
    <span class="c"># number of instances at the same time. The wait method provides a</span>
    <span class="c"># barrier to when it is safe to start the actual experiment.</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="c"># Print out the details of the instance. The details include instance id,</span>
    <span class="c"># private and public hostnames, and tags both defined by you and some</span>
    <span class="c"># added by the api</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">list</span><span class="p">())</span>

    <span class="c"># Run a command on the instances having the &quot;test1&quot; tag. In this case we</span>
    <span class="c"># only have one instance, but if you had multiple instances with that</span>
    <span class="c"># tag, the command would run on each one.</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s">&quot;test1&quot;</span><span class="p">],</span> <span class="s">&quot;echo &#39;Hello world from a experiment instance&#39;&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">ExperimentException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c"># This is the default exception for most errors in the api</span>
    <span class="k">print</span> <span class="s">&quot;ERROR: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="c"># Be sure to always deprovision the instances we have started. Putting</span>
    <span class="c"># the deprovision call under finally: make the deprovisioning happening</span>
    <span class="c"># even in the case of failure.</span>
    <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">exp</span><span class="o">.</span><span class="n">deprovision</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="resources-from-mulitple-infrastructures">
<h3><a class="toc-backref" href="#id5">3.3.2. Resources from mulitple infrastructures</a><a class="headerlink" href="#resources-from-mulitple-infrastructures" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">precip</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">ec2</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">fg</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">try</span><span class="p">:</span>

    <span class="c"># This example show how to run an experiment between Amazon EC2</span>
    <span class="c"># and an OpenStack resource on FutureGrid. The setup is pretty</span>
    <span class="c"># similar to the HelloWorld example, except that we now have to</span>
    <span class="c"># experiment to handle. The first step is to get the experiments</span>
    <span class="c"># initialized. Note that it is not required to use environment</span>
    <span class="c"># variables for your credentials, but seperating the crenditals</span>
    <span class="c"># from the code prevents the credentials from being check in to</span>
    <span class="c"># source control systems.</span>

    <span class="n">ec2</span> <span class="o">=</span> <span class="n">EC2Experiment</span><span class="p">(</span>
            <span class="s">&quot;us-west-2c&quot;</span><span class="p">,</span>
            <span class="s">&quot;ec2.us-west-2.amazonaws.com&quot;</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;AMAZON_EC2_ACCESS_KEY&#39;</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;AMAZON_EC2_SECRET_KEY&#39;</span><span class="p">])</span>

    <span class="n">fg</span> <span class="o">=</span> <span class="n">OpenStackExperiment</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;EC2_URL&#39;</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;EC2_ACCESS_KEY&#39;</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;EC2_SECRET_KEY&#39;</span><span class="p">])</span>

    <span class="c"># Next we provision two instances, one on Amazon EC2 and one of</span>
    <span class="c"># FutureGrid</span>
    <span class="n">ec2</span><span class="o">.</span><span class="n">provision</span><span class="p">(</span><span class="s">&quot;ami-8a1e92ba&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;id=ec2_1&quot;</span><span class="p">])</span>
    <span class="n">fg</span><span class="o">.</span><span class="n">provision</span><span class="p">(</span><span class="s">&quot;ami-0000004c&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;id=fg_1&quot;</span><span class="p">])</span>

    <span class="c"># Wait for all instances to boot and become accessible. The provision</span>
    <span class="c"># method only starts the provisioning, and can be used to start a large</span>
    <span class="c"># number of instances at the same time. The wait method provides a</span>
    <span class="c"># barrier to when it is safe to start the actual experiment.</span>
    <span class="n">ec2</span><span class="o">.</span><span class="n">wait</span><span class="p">([])</span>
    <span class="n">fg</span><span class="o">.</span><span class="n">wait</span><span class="p">([])</span>

    <span class="c"># Run commands on the remote instances</span>
    <span class="n">ec2</span><span class="o">.</span><span class="n">run</span><span class="p">([],</span> <span class="s">&quot;echo &#39;Hello world Amazon EC2&#39;&quot;</span><span class="p">)</span>
    <span class="n">fg</span><span class="o">.</span><span class="n">run</span><span class="p">([],</span> <span class="s">&quot;echo &#39;Hello world FutureGrid OpenStack&#39;&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">ExperimentException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c"># This is the default exception for most errors in the api</span>
    <span class="k">print</span> <span class="s">&quot;ERROR: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span>
    <span class="k">raise</span> <span class="n">e</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="c"># Be sure to always deprovision the instances we have started. Putting</span>
    <span class="c"># the deprovision call under finally: make the deprovisioning happening</span>
    <span class="c"># even in the case of failure.</span>
    <span class="k">if</span> <span class="n">ec2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ec2</span><span class="o">.</span><span class="n">deprovision</span><span class="p">([])</span>
    <span class="k">if</span> <span class="n">fg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fg</span><span class="o">.</span><span class="n">deprovision</span><span class="p">([])</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-a-condor-pool-and-run-a-pegasus-workflow">
<h3><a class="toc-backref" href="#id6">3.3.3. Setting up a Condor pool and run a Pegasus workflow</a><a class="headerlink" href="#setting-up-a-condor-pool-and-run-a-pegasus-workflow" title="Permalink to this headline">¶</a></h3>
<p>This is a more complex example in which a small Condor pool is set up
and then a Pegasus workflow is run and benchmarked. The Precip script is
similar to what we have seen before, but it has two groups of instances,
one master acting as the Condor central manager, and a set of Condor
worker nodes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">precip</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">try</span><span class="p">:</span>

    <span class="c"># This experiment is targeted to run on OpenStack</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="n">OpenStackExperiment</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;OPENSTACK_URL&#39;</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;OPENSTACK_ACCESS_KEY&#39;</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;OPENSTACK_SECRET_KEY&#39;</span><span class="p">])</span>

    <span class="c"># We need a master Condor node and a set of workers</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">provision</span><span class="p">(</span><span class="s">&quot;ami-0000004c&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;master&quot;</span><span class="p">],</span>
                  <span class="n">instance_type</span><span class="o">=</span><span class="s">&quot;m1.large&quot;</span><span class="p">)</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">provision</span><span class="p">(</span><span class="s">&quot;ami-0000004c&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;compute&quot;</span><span class="p">],</span>
                  <span class="n">instance_type</span><span class="o">=</span><span class="s">&quot;m1.large&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="c"># The workers need to know what the private hostname of the master is</span>
    <span class="n">master_priv_addr</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">get_private_hostnames</span><span class="p">([</span><span class="s">&quot;master&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c"># Bootstrap the instances. This includes installing Condor and Pegasus,</span>
    <span class="c"># downloading and settup the workflow.</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">copy_and_run</span><span class="p">([</span><span class="s">&quot;master&quot;</span><span class="p">],</span> <span class="s">&quot;./bootstrap.sh&quot;</span><span class="p">)</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">copy_and_run</span><span class="p">([</span><span class="s">&quot;compute&quot;</span><span class="p">],</span> <span class="s">&quot;./bootstrap.sh&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">master_priv_addr</span><span class="p">])</span>

    <span class="c"># Give the workers some time to register with the Condor central</span>
    <span class="c"># manager</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

    <span class="c"># Make sure Condor came up correctly</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s">&quot;master&quot;</span><span class="p">],</span> <span class="s">&quot;condor_status&quot;</span><span class="p">)</span>

    <span class="c"># Run the workflow</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s">&quot;master&quot;</span><span class="p">],</span> <span class="s">&quot;cd ~/montage &amp;&amp; ./run-montage&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&quot;wf&quot;</span><span class="p">)</span>

    <span class="c"># At this point, in a real experiment, you could for example provision</span>
    <span class="c"># more resources and run the workflow again, or run the workflow with</span>
    <span class="c"># different parameters/settings.</span>

<span class="k">except</span> <span class="n">ExperimentException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;ERROR: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="c"># always want to clean up all the instances we have started</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">deprovision</span><span class="p">([])</span>
</pre></div>
</div>
<p>We also need a bootstrap.sh which sets up the instances:</p>
<div class="highlight-python"><pre>#!/bin/bash

# This script bootstraps a basic RHEL6 instance to be have working
# Condor and Pegasus installs. The script takes one optional
# argument which is the address of the master instance (central
# manager in Condor terminology). If the argument is not given,
# the script sets up the instance to be the master.

MASTER_ADDR=$1

# for images with condor already installed, stop condor
/etc/init.d/condor stop &gt;/dev/null 2&gt;&amp;1 || /bin/true

# correct clock is important for most projects
yum -q -y install ntpdate
/etc/init.d/ntpdate start

# Add the EPEL repository
wget -nv http://mirror.utexas.edu/epel/6/x86_64/epel-release-6-7.noarch.rpm
rpm -Uh epel-release-*.noarch.rpm

# Add the Condor repository
cat &gt;/etc/yum.repos.d/condor.repo &lt;&lt;EOF
[condor-stable]
name=Condor Stable RPM Repository for Redhat Enterprise Linux 6
baseurl=http://www.cs.wisc.edu/condor/yum/stable/rhel6
enabled=1
gpgcheck=0
EOF

# Add the Pegasus repository
cat &gt;/etc/yum.repos.d/pegasus.repo &lt;&lt;EOF
[Pegasus]
name=Pegasus
baseurl=http://download.pegasus.isi.edu/wms/download/rhel/6/x86_64
gpgcheck=0
enabled=1
priority=50
EOF

# Install required software
yum -q -y clean all
yum -q -y install gcc gcc-g++ gcc-gfortran make gawk bison diffutils \
                  java-1.7.0-openjdk.x86_64 \
                  java-1.7.0-openjdk-devel.x86_64 \
                  ganglia-gmond condor pegasus

# Clear the Condor local config file - we use config.d instead
cat /dev/null &gt;/etc/condor/condor_config.local

# Common Condor config between master and workers
cat &gt;/etc/condor/config.d/50-main.conf &lt;&lt;EOF

CONDOR_HOST = $MASTER_ADDR

FILESYSTEM_DOMAIN = \$(FULL_HOSTNAME)
TRUST_UID_DOMAIN = True

DAEMON_LIST = MASTER, STARTD

# security
ALLOW_WRITE = 10.*
ALLOW_READ = \$(ALLOW_WRITE)

# default policy
START = True
SUSPEND = False
CONTINUE = True
PREEMPT = False
KILL = False

EOF

# Master gets extra packages/configs
if [ "x$MASTER_ADDR" = "x" ]; then
    yum -q -y install ganglia-gmetad ganglia-web

    cat &gt;/etc/condor/config.d/90-master.conf &lt;&lt;EOF
CONDOR_HOST = \$(FULL_HOSTNAME)
DAEMON_LIST = MASTER, COLLECTOR, NEGOTIATOR, SCHEDD
EOF
fi

# Restarting daemons
/etc/init.d/condor start

# User to run the workflows as, and allow the experiment management
# ssh key to authenticate
adduser wf
mkdir -p ~wf/.ssh
cp ~/.ssh/authorized_keys ~wf/.ssh/
chown -R wf: ~wf/.ssh

# Master is the submit host, so deploy our workflow on it
if [ "x$MASTER_ADDR" = "x" ]; then
    # install the workflow tarball and wait script
    cd ~wf
    wget -q http://pegasus.isi.edu/static/precip/wf-experiment/montage.tar.gz
    tar xzf montage.tar.gz
    chown -R wf: montage*
fi</pre>
</div>
</div>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>