<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Upgrading Nimbus On FG clusters &mdash; Cloud Computing Book 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.2/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/cosmo/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.2/css/bootstrap-responsive.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Cloud Computing Book 0.1 documentation" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="index.html">Contents</a>
        <span class="navbar-text pull-left"><b>0.1</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
              <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul>
<li class="toctree-l1"><a class="reference internal" href="plan.html">1. Plan: FutureGrid Manual update</a></li>
<li class="toctree-l1"><a class="reference internal" href="plan.html#objectives">2. Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="plan.html#deliverables">3. Deliverables</a></li>
<li class="toctree-l1"><a class="reference internal" href="plan.html#refernce-materials">4. Refernce Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="title.html">5.   Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="todolist.html">6. Todo List</a></li>
<li class="toctree-l1"><a class="reference internal" href="preface.html">7. Preface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preface.html#citation-for-publications">7.1. Citation for Publications</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#acknowledgement">7.2. Acknowledgement</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#sponsors">7.3. Sponsors</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#about-this-manual">7.4. About this Manual</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">8. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#executive-summary">8.1. Executive Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#project-and-account-application">8.2. Project and Account Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#services">8.3. Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#hardware">8.4. Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#support">8.5. Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html">9. Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#step-1-create-a-futuregrid-portal-account">9.1. Step 1: Create a FutureGrid Portal Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#step-2-create-a-new-project-or-join-an-existing-one">9.2. Step 2: Create a new Project or join an existing one</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#step-3-upload-your-ssh-public-key-s">9.3. Step 3: Upload Your SSH Public Key(s)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#accessing-futuregrid">10. Accessing FutureGrid</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#account-management-service">10.1. Account Management Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#key-reset-or-adding-new-keys">10.2. Key Reset or Adding new Keys</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#account-creation">11. Account Creation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#creating-an-hpc-account">11.1. Creating an HPC account</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#resetting-a-ssh-key">11.2. Resetting a ssh-key</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#nimbus-eucalyptus-openstack">11.3. Nimbus, Eucalyptus, OpenStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#training-and-education">11.4. Training and Education</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#guide-to-using-the-futuregrid-portal">12. Guide to Using the FutureGrid Portal</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#functions-of-the-futuregrid-portal">12.1. Functions of the FutureGrid Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#a-futuregrid-user-dashboard">12.2. A FutureGrid&nbsp;User Dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#update-project-information-and-add-results">12.3. Update Project Information and Add Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#contribute-to-the-futuregrid-community">12.4. Contribute to the FutureGrid Community</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#file-upload-and-attachment-to-a-page">12.5. File Upload and Attachment to a Page</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#hardware">13. Hardware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#compute-resources">13.1. Compute Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#storage-resources">13.2. Storage Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#status">13.3. Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#maintenance">13.4. Maintenance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#id1">14. Compute Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#compute-networks">14.1. Compute Networks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#alamo">15. Alamo</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#bravo">16. Bravo</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#delta">17. Delta</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#foxtrot">18. Foxtrot</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#hotel">19. Hotel</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#india">20. India</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#sierra">21. Sierra</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#xray">22. Xray</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#network">23. Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#futuregrid-network-impairments-device-nid">24. FutureGrid Network Impairments Device (NID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#storage">25. Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#using-hpss-from-futuregrid">26. Using HPSS from FutureGrid</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#id6">27. Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#accessing-futuregrid-resources-via-ssh">28. Accessing FutureGrid resources via SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#requirement-for-windows-users">29. Requirement for Windows Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#instructions-for-both-windows-and-unix-users">30. Instructions for both Windows and Unix users</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#generate-ssh-key">30.1. Generate SSH key</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#check-your-ssh-key">30.2. Check your ssh key</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#copy-the-content-of-your-public-key">30.3. Copy the content of your public key</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#upload-the-key-to-the-futuregrid-portal">30.4. Upload the key to the FutureGrid Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#testing-your-ssh-key">30.5. Testing your ssh key</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#testing-your-ssh-key-on-hotel">30.6. Testing your ssh key on Hotel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#hpc-services">31. HPC Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#using-hpc-services-on-futuregrid">32. Using HPC Services on FutureGrid</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#accessing-systems">32.1. Accessing Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#filesystem-layout">32.2. Filesystem Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#modules">32.3. Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#managing-applications-with-torque">32.4. Managing Applications with Torque</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#message-passing-interface-mpi">32.5. Message Passing Interface (MPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#mpi-libraries">32.6. MPI Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#compiling-mpi-applications">32.7. Compiling MPI&nbsp;Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#running-mpi-applications">32.8. Running MPI&nbsp;Applications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#log-in-to-hpc-services">33. Log in to HPC services</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#generating-ssh-keys-for-futuregrid-access">34. Generating SSH Keys for FutureGrid Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#key-generation">35. Key Generation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#generate-public-private-key-pair">35.1. <strong>1.&nbsp;</strong><strong>Generate Public/Private Key Pair</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#list-the-result">35.2. <strong>2.&nbsp;</strong><strong>List the result</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#add-or-replace-passphrase-for-an-already-generated-key">35.3. <strong>3.&nbsp;</strong><strong>Add or Replace Passphrase for an Already Generated Key</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#capture-the-public-key-for-futuregrid">35.4. <strong>4.</strong>&nbsp;&nbsp;<strong>Capture the Public Key for FutureGrid</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#key-management">35.5. 5. Key Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#resetting-the-ssh-key">35.6. 6. Resetting the SSH key</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#i-still-can-not-access-fg-resources">35.7. 7. I still can not access FG resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#working-with-hpc-job-services">36. Working with HPC Job Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#running-queued-jobs-as-part-of-the-hpc-services">36.1. Running Queued Jobs as Part of the HPC Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#monitoring-your-job">36.2. Monitoring Your Job</a></li>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#examining-your-job-output">36.3. Examining Your Job Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#id7">37. Xray</a><ul>
<li class="toctree-l2"><a class="reference internal" href="fgmanual.html#iu-cray-user-manual">37.1. IU Cray User Manual</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#id8">38. Alamo</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#iaas-infrastructure-as-a-service">39. IaaS - Infrastructure as a Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#using-iaas-clouds-on-futuregrid">40. Using IaaS Clouds on FutureGrid</a></li>
<li class="toctree-l1"><a class="reference internal" href="fgmanual.html#management-services">41. Management Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="part-2.html">42. Part 2 - OTHER STUFF</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">43. Building the Book</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#virtualenv">43.1. Virtualenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#theme">43.2. Theme</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#autorun">43.3. Autorun</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python.html">44. Just Enough Python for the Cloud</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python.html#terminal">44.1. Terminal</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#os-specific">44.2. OS Specific</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#lanaguage-features">44.3. Lanaguage Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#local">44.4. Local</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#ecosystem">44.5. Ecosystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#excersises">44.6. Excersises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="git.html">45. Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="openstack.html">46. OpenStack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#get-a-cloud-account">46.1. Get a cloud account</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack.html#commandline-clients">46.2. commandline clients</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="eucalyptus.html">47. Eucalyptus on FutureGrid</a><ul>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#summary">47.1. Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#requirements">47.2. Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#account-creation">47.3. Account Creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#resources-overview">47.4. Resources Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#testing-your-setup">47.5. Testing Your Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#image-deployment">47.6. Image Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#logging-into-the-vm">47.7. Logging Into the VM</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#vm-network-info">47.8. VM Network Info</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#image-management">47.9. Image Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="eucalyptus.html#status-of-deployments">47.10. Status of Deployments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="india.html">48. India on  FutureGrid</a></li>
</ul>
</ul>
</li>
              <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Upgrading Nimbus On FG clusters</a><ul>
<li><a class="reference internal" href="#disclaimer">Disclaimer</a></li>
<li><a class="reference internal" href="#upgrading-workspace-service-and-cumulus">Upgrading Workspace Service and Cumulus</a></li>
<li><a class="reference internal" href="#upgrading-workspace-control">Upgrading Workspace Control</a></li>
</ul>
</li>
</ul>
</ul>
</li>
            
            
              
            
            
              <li>
  <a href="_sources/nimbus-deploy.txt"
     rel="nofollow">Source</a></li>
            
          </ul>

          
            
<form class="navbar-search pull-right" action="search.html" method="get">
  <input type="text" name="q" class="search-query" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  
  <div class="section" id="upgrading-nimbus-on-fg-clusters">
<h1>Upgrading Nimbus On FG clusters<a class="headerlink" href="#upgrading-nimbus-on-fg-clusters" title="Permalink to this headline">¶</a></h1>
<div class="section" id="disclaimer">
<h2>Disclaimer<a class="headerlink" href="#disclaimer" title="Permalink to this headline">¶</a></h2>
<p>This document provides guidelines on how to upgrade Nimbus on
FutureGrid sites.&nbsp; It is not a definitive guide to upgrading Nimbus
anywhere.&nbsp; An admin&#8217;s own skills and intuition should be in full force
while following this guide.&nbsp; This page should be considered little more
than the notes from one effective upgrade from 2.7 to 2.8.</p>
</div>
<div class="section" id="upgrading-workspace-service-and-cumulus">
<h2>Upgrading Workspace Service and Cumulus<a class="headerlink" href="#upgrading-workspace-service-and-cumulus" title="Permalink to this headline">¶</a></h2>
<p>First create a source directory and download the latest Nimbus release
from
<a class="reference external" href="http://www.nimbusproject.org/downloads/">http://www.nimbusproject.org/downloads/</a>,
and untar the distributions:</p>
<div class="highlight-python"><pre>mkdir ~/src
wget http://www.nimbusproject.org/downloads/nimbus-iaas-2.8-src.tar.gz
tar -xzf nimbus-iaas-2.8-src.tar.gz
wget http://www.nimbusproject.org/downloads/nimbus-iaas-controls-2.8.tar.gz
tar -zxf nimbus-iaas-controls-2.8.tar.gz</pre>
</div>
<p>For convenience set the following variables:</p>
<div class="highlight-python"><pre>export OLD_NIMBUS=&lt;path to old nimbus install&gt;
export NEW_NIMBUS=&lt;path to new nimbus install&gt;</pre>
</div>
<p>Make sure that the old install is not running:</p>
<div class="highlight-python"><pre>$OLD_NIMBUS/bin/nimbusctl stop</pre>
</div>
<p>Install the new Nimbus. If you are on an old distribution such as CentOS
5, you might need to set the OLD_OPENSSL_VERSION environment variable.
If you run into Java OOM issues, export the following variable: export
ANT_OPTS=-Xmx1024M.&nbsp;When asked any questions just hit enter:</p>
<div class="highlight-python"><pre>./install $NEW_NIMBUS</pre>
</div>
<p>Run the following commands to transfer over the env.&nbsp;<strong>*NOTE*</strong> please
check that you are ok with these commands first, do not blindly copy and
paste them.&nbsp;<strong>*These commands DELETE things!*</strong></p>
<div class="highlight-python"><pre>rm -rf $NEW_NIMBUS/var/ca
rm $NEW_NIMBUS/var/hostcert.pem
rm $NEW_NIMBUS/var/hostkey.pem
rm $NEW_NIMBUS/var/keystore.jks

cp $OLD_NIMBUS/nimbus-setup.conf $NEW_NIMBUS/nimbus-setup.conf

export PREVIOUS_NIMBUS_HOME_VALIDATED=$OLD_NIMBUS
$NEW_NIMBUS/bin/nimbus-configure --conf $NEW_NIMBUS/nimbus-setup.conf  --import-cumulusdb
$NEW_NIMBUS/bin/nimbus-configure --conf $NEW_NIMBUS/nimbus-setup.conf --import-prev

cp $OLD_NIMBUS/services/etc/nimbus/workspace-service/metadata.conf $NEW_NIMBUS/services/etc/nimbus/workspace-service/metadata.conf</pre>
</div>
<p>Import SSH keys from the Elastic interface:</p>
<div class="highlight-python"><pre>sqlite3 $OLD_NIMBUS/services/var/nimbus/elastic.db
sqlite&gt; .output /N/u/nimbus/ssh_keypairs
sqlite&gt; .dump ssh_keypairs
sqlite&gt; .quit

sqlite3 $NEW_NIMBUS/services/var/nimbus/elastic.db
sqlite&gt; .read /N/u/nimbus/ssh_keypairs
sqlite&gt; .quit</pre>
</div>
<p>Manually check the remaining differences in the configuration files.
The differences will be very site dependent so put on your thinking
cap.&nbsp; The following script will diff out all the conf files.&nbsp; Go through
the output and make sure you merge over all the needed changes for your
site</p>
<div class="highlight-python"><pre>cd $OLD_NIMBUS
confs=`find . -name '*.conf'`
for c in $confs
do
    diff -q -u $OLD_NIMBUS/$c $NEW_NIMBUS/$c</pre>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">done</span>
</pre></div>
</div>
<p>Now verify that services/etc/nimbus-context-broker/jndi-config.xml has
the right caCertPath and caKeyPath (in almost every case it will not
have the right values).
Also verify that&nbsp;services/etc/globus_wsrf_core/server-config.wsdd
has the right&nbsp;logicalHost.
Also verify the customizations
in&nbsp;services/etc/nimbus/workspace-service/other/authz-callout-ACTIVE.xml
are still enabled (for example cp propagation).</p>
<p>Also check $NEW_NIMBUS/cumulus/etc/cumulus.ini for the backend
data_dir if you are using type &#8216;posix&#8217; (which you likely are).
And check
$NEW_NIMBUS/services/etc/nimbus/workspace-service/cumulus.conf for the
cumulus.authz.db and cumulus.repo.dir settings.</p>
<p>Now you must load up the new Nimbus install with the backends from
the old install.&nbsp; The following python script can help with that task.
Simply give it two arguments: $OLD_NIMBUS $NEW_NIMBUS</p>
<p><a class="reference external" href="https://raw.github.com/nimbusproject/nimbus/master/docs/src/admin/reload.py">https://raw.github.com/nimbusproject/nimbus/master/docs/src/admin/reload.py</a></p>
</div>
<div class="section" id="upgrading-workspace-control">
<h2>Upgrading Workspace Control<a class="headerlink" href="#upgrading-workspace-control" title="Permalink to this headline">¶</a></h2>
<p>Set up the workspace control nodes by doing the following:</p>
<ol class="arabic simple">
<li>Move the old install from /opt/nimbus to /opt/nimbus2.7</li>
<li>Create the directory /opt/nimbus2.8 and have it owned by the nimbus
user and group</li>
<li>Create a symlink from /opt/nimbus to /opt/nimbus2.8</li>
</ol>
<p>Now copy the old working workspace control code from a working VMM
node to the source directory:</p>
<div class="highlight-python"><pre>scp -r working_node:/opt/nimbus2.7 ~/src/</pre>
</div>
<p>Just like in the above step, run the following diff script to find
configuration differences, give it the full path to nimbus2.7 as the
first argument and the full path to the new distribution at the second:</p>
<div class="highlight-python"><pre>cd $1
confs=`find . -name '*.conf'`
for c in $confs
do
    diff -u $1/$c $2/$c</pre>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">done</span>
</pre></div>
</div>
<p>Merge all of the differences.&nbsp; Check out the following files and merge
the differences:</p>
<p>libexec/workspace-control/mount-alter.sh
lantorrent/etc/*
etc/workspace-control/libvirt_template.xml</p>
<p>Make sure that everything in nimbus2.7/var/workspace-control/kernels
is also in
nimbus-iaas-controls-2.8/workspace-control/var/workspace-control/kernels</p>
<p>scp everything under nimbus-iaas-controls-2.8/workspace-control to
all VMM nodes:/opt/nimbus/</p>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>